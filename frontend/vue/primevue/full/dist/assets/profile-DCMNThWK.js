import{y as q,a2 as A,q as F,z as _,a3 as p,A as $,c as m,l as e,a as o,w as P,E as i,o as f,a5 as C,i as v,t as w,a7 as h}from"./index-ClbwuvgW.js";import{s as N}from"./index-LwmQ9GO6.js";import{s as S}from"./index-CO05eax1.js";import{a as b}from"./index-DmDW0EJB.js";import{s as V}from"./index-CNYpXzrl.js";import{s as B}from"./index-CNnvIFhq.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-B6u3Hjan.js";const D={class:"profile-page"},j={class:"profile-grid"},z={class:"form-field"},O={class:"form-field"},R={key:0,class:"p-error"},G={class:"form-field"},H={class:"form-field"},J={class:"form-field"},K={class:"form-actions"},L={class:"form-field"},Q={key:0,class:"p-error"},T={class:"form-field"},W={key:0,class:"p-error"},X={class:"form-field"},Y={key:0,class:"p-error"},Z={class:"form-actions"},ss={__name:"profile",setup(es){const k=q(),c=A(),d=F(()=>k.user),g=_(!1),y=_(!1),t=p({email:"",name:""}),u=p({email:""}),a=p({currentPassword:"",newPassword:"",confirmPassword:""}),r=p({currentPassword:"",newPassword:"",confirmPassword:""});$(()=>{d.value&&(t.email=d.value.email||"",t.name=d.value.name||"")});const U=()=>{let l=!0;return u.email="",t.email.trim()?/\S+@\S+\.\S+/.test(t.email)||(u.email="Invalid email format",l=!1):(u.email="Email is required",l=!1),l},E=()=>{let l=!0;return Object.keys(r).forEach(s=>r[s]=""),a.currentPassword||(r.currentPassword="Current password is required",l=!1),a.newPassword?a.newPassword.length<6&&(r.newPassword="Password must be at least 6 characters",l=!1):(r.newPassword="New password is required",l=!1),a.confirmPassword?a.newPassword!==a.confirmPassword&&(r.confirmPassword="Passwords do not match",l=!1):(r.confirmPassword="Please confirm your new password",l=!1),l},M=async()=>{if(U()){g.value=!0;try{await h.updateProfile({email:t.email,name:t.name}),await k.fetchProfile(),c.success("Profile updated successfully")}catch(l){c.error(l.response?.data?.message||"Failed to update profile")}finally{g.value=!1}}},x=async()=>{if(E()){y.value=!0;try{await h.changePassword({currentPassword:a.currentPassword,newPassword:a.newPassword}),c.success("Password changed successfully"),a.currentPassword="",a.newPassword="",a.confirmPassword=""}catch(l){c.error(l.response?.data?.message||"Failed to change password")}finally{y.value=!1}}};return(l,s)=>(f(),m("div",D,[s[16]||(s[16]=e("div",{class:"page-header"},[e("h1",null,"My Profile"),e("p",{class:"page-subtitle"},"Manage your account settings")],-1)),e("div",j,[o(i(N),{class:"profile-card"},{title:P(()=>[...s[5]||(s[5]=[e("div",{class:"card-title-with-icon"},[e("i",{class:"pi pi-user"}),e("span",null,"Profile Information")],-1)])]),content:P(()=>[e("form",{onSubmit:C(M,["prevent"]),class:"profile-form"},[e("div",z,[s[6]||(s[6]=e("label",{for:"username"},"Username",-1)),o(i(b),{id:"username",value:d.value?.username,disabled:"",class:"w-full"},null,8,["value"]),s[7]||(s[7]=e("small",{class:"help-text"},"Username cannot be changed",-1))]),e("div",O,[s[8]||(s[8]=e("label",{for:"email"},"Email *",-1)),o(i(b),{id:"email",modelValue:t.email,"onUpdate:modelValue":s[0]||(s[0]=n=>t.email=n),type:"email",invalid:!!u.email,class:"w-full"},null,8,["modelValue","invalid"]),u.email?(f(),m("small",R,w(u.email),1)):v("",!0)]),e("div",G,[s[9]||(s[9]=e("label",{for:"name"},"Name",-1)),o(i(b),{id:"name",modelValue:t.name,"onUpdate:modelValue":s[1]||(s[1]=n=>t.name=n),class:"w-full"},null,8,["modelValue"])]),e("div",H,[s[10]||(s[10]=e("label",null,"Role",-1)),o(i(B),{value:d.value?.role,severity:d.value?.role==="Admin"?"danger":"info"},null,8,["value","severity"])]),e("div",J,[s[11]||(s[11]=e("label",null,"Department",-1)),e("span",null,w(d.value?.departmentName||"Not assigned"),1)]),e("div",K,[o(i(S),{type:"submit",label:"Update Profile",loading:g.value,icon:"pi pi-check"},null,8,["loading"])])],32)]),_:1}),o(i(N),{class:"password-card"},{title:P(()=>[...s[12]||(s[12]=[e("div",{class:"card-title-with-icon"},[e("i",{class:"pi pi-lock"}),e("span",null,"Change Password")],-1)])]),content:P(()=>[e("form",{onSubmit:C(x,["prevent"]),class:"password-form"},[e("div",L,[s[13]||(s[13]=e("label",{for:"currentPassword"},"Current Password *",-1)),o(i(V),{id:"currentPassword",modelValue:a.currentPassword,"onUpdate:modelValue":s[2]||(s[2]=n=>a.currentPassword=n),feedback:!1,toggleMask:"",invalid:!!r.currentPassword,inputClass:"w-full",class:"w-full"},null,8,["modelValue","invalid"]),r.currentPassword?(f(),m("small",Q,w(r.currentPassword),1)):v("",!0)]),e("div",T,[s[14]||(s[14]=e("label",{for:"newPassword"},"New Password *",-1)),o(i(V),{id:"newPassword",modelValue:a.newPassword,"onUpdate:modelValue":s[3]||(s[3]=n=>a.newPassword=n),toggleMask:"",invalid:!!r.newPassword,inputClass:"w-full",class:"w-full"},null,8,["modelValue","invalid"]),r.newPassword?(f(),m("small",W,w(r.newPassword),1)):v("",!0)]),e("div",X,[s[15]||(s[15]=e("label",{for:"confirmPassword"},"Confirm New Password *",-1)),o(i(V),{id:"confirmPassword",modelValue:a.confirmPassword,"onUpdate:modelValue":s[4]||(s[4]=n=>a.confirmPassword=n),feedback:!1,toggleMask:"",invalid:!!r.confirmPassword,inputClass:"w-full",class:"w-full"},null,8,["modelValue","invalid"]),r.confirmPassword?(f(),m("small",Y,w(r.confirmPassword),1)):v("",!0)]),e("div",Z,[o(i(S),{type:"submit",label:"Change Password",loading:y.value,icon:"pi pi-lock",severity:"warning"},null,8,["loading"])])],32)]),_:1})])]))}},us=I(ss,[["__scopeId","data-v-24d09627"]]);export{us as default};
