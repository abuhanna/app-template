import{a2 as K,z as w,q as S,a3 as I,A as G,c as u,l as i,a,E as t,w as n,o as p,t as m,M as D,j as $,a4 as H,a5 as J,i as f,a6 as Q}from"./index-ClbwuvgW.js";import{u as W}from"./user-C0EkE2Q2.js";import{u as X}from"./department-BdgeOQz3.js";import{u as Y,s as Z,a as c,b as ee,c as le,e as E,d as se}from"./index-BwztZg9L.js";import{s as ae}from"./index-LwmQ9GO6.js";import{s as g}from"./index-CO05eax1.js";import{a as h}from"./index-DmDW0EJB.js";import{s as te}from"./index-CNYpXzrl.js";import{s as ie}from"./index-F3f4gsKq.js";import{s as N}from"./index-CNnvIFhq.js";import{s as oe}from"./index-Yx-PzZM6.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-B6u3Hjan.js";const ne={class:"users-page"},de={class:"page-header"},me={class:"table-header"},ue={class:"user-cell"},pe={class:"action-buttons"},ce={class:"form-field"},fe={key:0,class:"p-error"},ve={class:"form-field"},be={key:0,class:"p-error"},ye={class:"form-field"},we={key:0,class:"form-field"},ge={key:0,class:"p-error"},Ue={class:"form-field"},Ve={key:0,class:"p-error"},he={class:"form-field"},Ae={key:1,class:"form-field"},_e={class:"flex align-items-center gap-2"},ke={__name:"index",setup(xe){const v=W(),k=X(),b=K(),{confirmDelete:M}=Y(),A=w(!1),_=w(!1),y=w(!1),d=w(null),U=w({global:{value:null,matchMode:Q.CONTAINS}}),O=S(()=>v.users),j=S(()=>k.departments),q=[{label:"User",value:"User"},{label:"Admin",value:"Admin"}],l=I({username:"",email:"",name:"",password:"",role:"User",departmentId:null,isActive:!0}),r=I({username:"",email:"",password:"",role:""}),P=o=>o.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2),F=()=>{l.username="",l.email="",l.name="",l.password="",l.role="User",l.departmentId=null,l.isActive=!0,Object.keys(r).forEach(o=>r[o]="")},B=()=>{d.value=null,F(),y.value=!0},L=o=>{d.value=o,l.username=o.username,l.email=o.email,l.name=o.name||"",l.role=o.role,l.departmentId=o.departmentId,l.isActive=o.isActive,Object.keys(r).forEach(e=>r[e]=""),y.value=!0},x=()=>{y.value=!1,d.value=null},R=()=>{let o=!0;return Object.keys(r).forEach(e=>r[e]=""),l.username.trim()||(r.username="Username is required",o=!1),l.email.trim()?/\S+@\S+\.\S+/.test(l.email)||(r.email="Invalid email format",o=!1):(r.email="Email is required",o=!1),!d.value&&!l.password&&(r.password="Password is required",o=!1),l.role||(r.role="Role is required",o=!1),o},C=async()=>{if(R()){_.value=!0;try{d.value?(await v.updateUser(d.value.id,{email:l.email,name:l.name,role:l.role,departmentId:l.departmentId,isActive:l.isActive}),b.success("User updated successfully")):(await v.createUser({username:l.username,email:l.email,name:l.name,password:l.password,role:l.role,departmentId:l.departmentId}),b.success("User created successfully")),x()}catch(o){b.error(o.response?.data?.message||"Operation failed")}finally{_.value=!1}}},T=async o=>{if(await M(o.username))try{await v.deleteUser(o.id),b.success("User deleted successfully")}catch(V){b.error(V.response?.data?.message||"Delete failed")}};return G(async()=>{A.value=!0;try{await Promise.all([v.fetchUsers(),k.fetchDepartments()])}finally{A.value=!1}}),(o,e)=>{const V=H;return p(),u("div",ne,[i("div",de,[e[10]||(e[10]=i("div",null,[i("h1",null,"User Management"),i("p",{class:"page-subtitle"},"Manage system users and their permissions")],-1)),a(t(g),{label:"Add User",icon:"pi pi-plus",onClick:B})]),a(t(ae),null,{content:n(()=>[a(t(Z),{value:O.value,loading:A.value,paginator:"",rows:10,rowsPerPageOptions:[5,10,25,50],dataKey:"id",filterDisplay:"row",filters:U.value,"onUpdate:filters":e[1]||(e[1]=s=>U.value=s),globalFilterFields:["username","email","name","role"],responsiveLayout:"scroll",class:"users-table"},{header:n(()=>[i("div",me,[a(t(ee),null,{default:n(()=>[a(t(le),{class:"pi pi-search"}),a(t(h),{modelValue:U.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=s=>U.value.global.value=s),placeholder:"Search users..."},null,8,["modelValue"])]),_:1})])]),empty:n(()=>[...e[11]||(e[11]=[i("div",{class:"table-empty"},[i("i",{class:"pi pi-users"}),i("span",null,"No users found")],-1)])]),default:n(()=>[a(t(c),{field:"username",header:"Username",sortable:"",style:{"min-width":"150px"}},{body:n(({data:s})=>[i("div",ue,[a(t(oe),{label:P(s.name||s.username),shape:"circle"},null,8,["label"]),i("span",null,m(s.username),1)])]),_:1}),a(t(c),{field:"email",header:"Email",sortable:"",style:{"min-width":"200px"}}),a(t(c),{field:"name",header:"Name",sortable:"",style:{"min-width":"150px"}},{body:n(({data:s})=>[D(m(s.name||"-"),1)]),_:1}),a(t(c),{field:"role",header:"Role",sortable:"",style:{"min-width":"100px"}},{body:n(({data:s})=>[a(t(N),{value:s.role,severity:s.role==="Admin"?"danger":"info"},null,8,["value","severity"])]),_:1}),a(t(c),{field:"departmentName",header:"Department",sortable:"",style:{"min-width":"150px"}},{body:n(({data:s})=>[D(m(s.departmentName||"-"),1)]),_:1}),a(t(c),{field:"isActive",header:"Status",sortable:"",style:{"min-width":"100px"}},{body:n(({data:s})=>[a(t(N),{value:s.isActive?"Active":"Inactive",severity:s.isActive?"success":"secondary"},null,8,["value","severity"])]),_:1}),a(t(c),{header:"Actions",style:{"min-width":"120px"}},{body:n(({data:s})=>[i("div",pe,[$(a(t(g),{icon:"pi pi-pencil",text:"",rounded:"",severity:"info",onClick:z=>L(s)},null,8,["onClick"]),[[V,"Edit",void 0,{top:!0}]]),$(a(t(g),{icon:"pi pi-trash",text:"",rounded:"",severity:"danger",onClick:z=>T(s)},null,8,["onClick"]),[[V,"Delete",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading","filters"])]),_:1}),a(t(ie),{visible:y.value,"onUpdate:visible":e[9]||(e[9]=s=>y.value=s),header:d.value?"Edit User":"Create User",style:{width:"500px"},modal:"",class:"user-dialog"},{footer:n(()=>[a(t(g),{label:"Cancel",text:"",onClick:x}),a(t(g),{label:d.value?"Update":"Create",loading:_.value,onClick:C},null,8,["label","loading"])]),default:n(()=>[i("form",{onSubmit:J(C,["prevent"]),class:"dialog-form"},[i("div",ce,[e[12]||(e[12]=i("label",{for:"username"},"Username *",-1)),a(t(h),{id:"username",modelValue:l.username,"onUpdate:modelValue":e[2]||(e[2]=s=>l.username=s),disabled:!!d.value,invalid:!!r.username,class:"w-full"},null,8,["modelValue","disabled","invalid"]),r.username?(p(),u("small",fe,m(r.username),1)):f("",!0)]),i("div",ve,[e[13]||(e[13]=i("label",{for:"email"},"Email *",-1)),a(t(h),{id:"email",modelValue:l.email,"onUpdate:modelValue":e[3]||(e[3]=s=>l.email=s),type:"email",invalid:!!r.email,class:"w-full"},null,8,["modelValue","invalid"]),r.email?(p(),u("small",be,m(r.email),1)):f("",!0)]),i("div",ye,[e[14]||(e[14]=i("label",{for:"name"},"Name",-1)),a(t(h),{id:"name",modelValue:l.name,"onUpdate:modelValue":e[4]||(e[4]=s=>l.name=s),class:"w-full"},null,8,["modelValue"])]),d.value?f("",!0):(p(),u("div",we,[e[15]||(e[15]=i("label",{for:"password"},"Password *",-1)),a(t(te),{id:"password",modelValue:l.password,"onUpdate:modelValue":e[5]||(e[5]=s=>l.password=s),invalid:!!r.password,toggleMask:"",inputClass:"w-full",class:"w-full"},null,8,["modelValue","invalid"]),r.password?(p(),u("small",ge,m(r.password),1)):f("",!0)])),i("div",Ue,[e[16]||(e[16]=i("label",{for:"role"},"Role *",-1)),a(t(E),{id:"role",modelValue:l.role,"onUpdate:modelValue":e[6]||(e[6]=s=>l.role=s),options:q,optionLabel:"label",optionValue:"value",invalid:!!r.role,class:"w-full"},null,8,["modelValue","invalid"]),r.role?(p(),u("small",Ve,m(r.role),1)):f("",!0)]),i("div",he,[e[17]||(e[17]=i("label",{for:"department"},"Department",-1)),a(t(E),{id:"department",modelValue:l.departmentId,"onUpdate:modelValue":e[7]||(e[7]=s=>l.departmentId=s),options:j.value,optionLabel:"name",optionValue:"id",placeholder:"Select department",showClear:"",class:"w-full"},null,8,["modelValue","options"])]),d.value?(p(),u("div",Ae,[e[18]||(e[18]=i("label",{for:"isActive"},"Status",-1)),i("div",_e,[a(t(se),{id:"isActive",modelValue:l.isActive,"onUpdate:modelValue":e[8]||(e[8]=s=>l.isActive=s)},null,8,["modelValue"]),i("span",null,m(l.isActive?"Active":"Inactive"),1)])])):f("",!0)],32)]),_:1},8,["visible","header"])])}}},Be=re(ke,[["__scopeId","data-v-2b3e0e80"]]);export{Be as default};
