import{a0 as s,k as y,l as c,e as R,d as g,aX as S,a9 as N}from"./index-D462s2qb.js";const l={getMyNotifications(o={}){return s.get("/notifications",{params:o})},markAsRead(o){return s.put(`/notifications/${o}/read`)},markAllAsRead(){return s.put("/notifications/read-all")}},C=y("persistentNotification",()=>{const o=c([]),i=c(!1),a=c(null),d=R(()=>o.value.filter(t=>!t.isRead).length),f=t=>{o.value.unshift(t),N().showInfo(`New Notification: ${t.title}`)},p=async()=>{const e=g().token;if(e&&!a.value){const{Client:n}=await S(async()=>{const{Client:r}=await import("./index-BBR-rEjr.js");return{Client:r}},[]),h="http://localhost:5100/api",m=window.location.protocol==="https:"?"wss:":"ws:",v=h.replace(/^https?:\/\//,"").replace(/\/api\/?$/,""),A=`${m}//${v}/ws`;a.value=new n({brokerURL:A,connectHeaders:{Authorization:`Bearer ${e}`},debug:function(r){},reconnectDelay:5e3,heartbeatIncoming:4e3,heartbeatOutgoing:4e3}),a.value.onConnect=r=>{a.value.subscribe("/user/queue/notifications",k=>{const w=JSON.parse(k.body);f(w)}),u()},a.value.onStompError=r=>{console.error("Broker reported error: "+r.headers.message),console.error("Additional details: "+r.body)},a.value.activate()}},u=async(t={})=>{i.value=!0;try{const e={limit:15,...t},n=await l.getMyNotifications(e);o.value=n.data.items||[]}catch(e){console.error("Failed to fetch notifications",e)}finally{i.value=!1}};return{notifications:o,loading:i,unreadCount:d,fetchNotifications:u,markAsRead:async t=>{try{await l.markAsRead(t);const e=o.value.findIndex(n=>n.id===t);return e!==-1&&(o.value[e].isRead=!0),!0}catch(e){return console.error("Failed to mark as read",e),!1}},markAllAsRead:async()=>{try{await l.markAllAsRead();for(const t of o.value)t.isRead=!0;return!0}catch(t){return console.error("Failed to mark all as read",t),!1}},initSignalR:p}});export{C as u};
